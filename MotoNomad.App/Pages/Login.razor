@page "/login"
@layout MainLayout

<PageTitle>Login - MotoNomad</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-8">
    <MudCard Elevation="5">
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h4" Align="Align.Center">
                    Login
                </MudText>
            </CardHeaderContent>
        </MudCardHeader>
        
        <MudCardContent>
            @if (!string.IsNullOrEmpty(_errorMessage))
            {
                <MudAlert Severity="Severity.Error" Class="mb-4">
                    @_errorMessage
                </MudAlert>
            }
  
            <MudForm @ref="_form" @bind-IsValid="@_formValid">
                <MudTextField @bind-Value="_model.Email"
                    Label="Email"
                    Variant="Variant.Outlined"
                    Required="true"
                    RequiredError="Email is required"
                    Validation="@EmailValidation"
                    Immediate="true"
                    MaxLength="255"
                    Adornment="Adornment.Start"
                    AdornmentIcon="@Icons.Material.Filled.Email"
                    @ref="_emailField"
                    Class="mb-4" />
             
                <MudTextField @bind-Value="_model.Password"
                    Label="Password"
                    Variant="Variant.Outlined"
                    InputType="InputType.Password"
                    Required="true"
                    RequiredError="Password is required"
                    Validation="@PasswordValidation"
                    Immediate="true"
                    MaxLength="100"
                    Adornment="Adornment.Start"
                    AdornmentIcon="@Icons.Material.Filled.Lock"
                    Class="mb-4" />
            </MudForm>
  
            @if (_isLoading)
            {
                <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="mb-4" />
            }
        </MudCardContent>
        
        <MudCardActions>
            <MudButton Variant="Variant.Filled"
                        Color="Color.Primary"
                        FullWidth="true"
                        OnClick="HandleLoginAsync"
                        Disabled="@(_isLoading || !_formValid)"
                        StartIcon="@Icons.Material.Filled.Login">
                @if (_isLoading)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                    <MudText Class="ml-2">Logging in...</MudText>
                }
                else
                {
                    <span>Login</span>
                }
            </MudButton>
        </MudCardActions>
        
        <MudCardActions Class="justify-center">
            <MudLink Href="/register" Color="Color.Primary">
                Don't have an account? Register
            </MudLink>
        </MudCardActions>
    </MudCard>
</MudContainer>
